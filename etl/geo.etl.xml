<!DOCTYPE etl SYSTEM "http://scriptella.org/dtd/etl.dtd">
<etl>
    <description>Implement Geographic information</description>

    <!-- Connection declarations -->
    <connection id="countrydata" driver="csv" url="../source-data/geo/country-data.csv">
        <!-- "isocode","caplat","caplon","continent" -->
        null_string=0
    </connection>
    <connection id="out" url="jdbc:postgresql://localhost:5432/project_ace" user="admin" password="password">
    </connection>

    <!-- Reset tables -->
    <script connection-id="out">
        DROP TABLE IF EXISTS HasCapitalLatitude;
        CREATE TABLE HasCapitalLatitude (
            cc varchar,
            latitude real
        );

        DROP TABLE IF EXISTS IsInContinent;
        CREATE TABLE IsInContinent (
            cc varchar,
            continent varchar
        );
    </script>

    <!-- Go through the whole CSV and populate the tables -->
    <query connection-id="countrydata">
        <!-- Empty query selects everything -->

        <script connection-id="out">
            INSERT INTO HasCapitalLatitude VALUES (
                ?isocode,
                CAST(?caplat AS real)
            );
            INSERT INTO IsInContinent VALUES (
                ?isocode,
                ?continent
            );
        </script>
    </query>

    
</etl>
